{"version":3,"file":"/packages/telescope-singleday.js","sources":["telescope-singleday//Users/grahammcbain/apto/Telescope/packages/telescope-singleday/package-tap.i18n","telescope-singleday/lib/routes.js","telescope-singleday/lib/singleday.js","telescope-singleday/lib/client/templates/posts_digest.html","telescope-singleday/lib/client/templates/posts_digest.js","telescope-singleday//Users/grahammcbain/apto/Telescope/packages/telescope-singleday/i18n/de.i18n.json","telescope-singleday//Users/grahammcbain/apto/Telescope/packages/telescope-singleday/i18n/en.i18n.json","telescope-singleday//Users/grahammcbain/apto/Telescope/packages/telescope-singleday/i18n/es.i18n.json","telescope-singleday//Users/grahammcbain/apto/Telescope/packages/telescope-singleday/i18n/fr.i18n.json","telescope-singleday//Users/grahammcbain/apto/Telescope/packages/telescope-singleday/i18n/it.i18n.json","telescope-singleday//Users/grahammcbain/apto/Telescope/packages/telescope-singleday/i18n/tr.i18n.json","telescope-singleday//Users/grahammcbain/apto/Telescope/packages/telescope-singleday/i18n/zh-CN.i18n.json"],"names":[],"mappings":";;;;;;;;AAAA,qH;;AAEA,+D;AACA,gD;AACA,2C;AACA,+E;AACA,uH;;AAEA,qD;AACA,6B;AACA,yC;;;;;;;;;;;;;;;;;;;ACVA,6B;;AAEA,gD;AACA,wC;AACA,sB;AACA,uD;AACA,sH;AACA,iB;AACA,yB;AACA,6D;AACA,2D;AACA,U;AACA,Y;AACA,sD;AACA,0D;AACA,M;AACA,I;AACA,oB;AACA,gI;AACA,iB;AACA,yB;AACA,6D;AACA,2D;AACA,U;AACA,+C;AACA,4C;;AAEA,yE;AACA,gE;;AAEA,qB;AACA,wE;AACA,wE;;AAEA,Y;AACA,8B;AACA,kB;AACA,M;AACA,I;AACA,kB;AACA,G;;AAEA,4B;;AAEA,W;;AAEA,6C;AACA,yB;AACA,qC;AACA,K;;AAEA,2B;AACA,iC;AACA,qC;AACA,K;;AAEA,G;;;;;;;;;;;;;;;;;;ACxDA,c;AACA,gC;AACA,iB;AACA,G;;AAEA,0C;AACA,U;AACA,W;AACA,iB;AACA,2B;AACA,yB;AACA,O;AACA,M;AACA,c;AACA,iD;AACA,K;AACA,I;AACA,C;;AAEA,gC;AACA,6C;AACA,wB;AACA,8B;AACA,sB;AACA,K;AACA,E;;;;;;;;;;;;;;;;;;;ACxBA,qC;AACA,8E;AACA,kB;AACA,qB;AACA,mB;AACA,yB;AACA,yB;AACA,wC;AACA,+E;AACA,uC;AACA,2D;AACA,iB;AACA,+B;AACA,wB;AACA,kE;AACA,Q;AACA,0B;AACA,8B;AACA,kE;AACA,sB;AACA,uC;AACA,0D;AACA,uC;AACA,uD;AACA,iB;AACA,+B;AACA,wB;AACA,8D;AACA,Q;AACA,0B;AACA,8B;AACA,8D;AACA,oB;AACA,oE;AACA,Y;AACA,iE;AACA,mD;AACA,M;AACA,iB;AACA,yC;AACA,gD;AACA,O;AACA,qC;AACA,mD;AACA,iB;AACA,iC;AACA,gC;AACA,0C;AACA,kD;AACA,mB;AACA,6D;AACA,gB;AACA,4D;AACA,U;AACA,qB;AACA,6C;AACA,oD;AACA,W;AACA,uB;AACA,4B;AACA,iB;AACA,iC;AACA,6C;AACA,iD;AACA,wE;AACA,oC;AACA,4D;AACA,kC;AACA,O;AACA,I;;;;;;;;;;;;;;;;;;;ACtEA,4B;;AAEA,6D;AACA,6F;AACA,sE;AACA,gD;AACA,iD;AACA,8C;AACA,O;AACA,kD;AACA,uE;AACA,sD;AACA,S;AACA,I;;AAEA,iD;AACA,4B;AACA,sC;AACA,M;AACA,oC;AACA,8C;AACA,M;AACA,yB;AACA,2B;AACA,sC;AACA,M;AACA,4B;AACA,yD;AACA,mC;AACA,+C;AACA,oB;AACA,+B;AACA,oB;AACA,mC;AACA,sD;AACA,M;AACA,gC;AACA,yD;AACA,kD;AACA,mC;AACA,M;AACA,iC;AACA,a;AACA,kB;AACA,M;AACA,4B;AACA,yD;AACA,6C;AACA,mC;AACA,M;AACA,6B;AACA,wE;AACA,kD;AACA,4E;AACA,K;AACA,K;;AAEA,8D;AACA,4B;AACA,+B;AACA,0C;AACA,O;AACA,wB;AACA,oD;AACA,oD;AACA,yD;AACA,G;;AAEA,8D;AACA,+C;AACA,I;;AAEA,G;;;;;;;;;;;;;;;;;;ACxEA,6B;AACA,yC;AACA,sC;;AAEA,gC;AACA,yD;AACA,C;AACA,8E;;AAEA,oD;AACA,8C;;AAEA,yC;AACA,C;;;;;;;;;;;;;;;;;;;ACbA,6B;AACA,yC;AACA,sC;;AAEA,gC;AACA,yD;AACA,C;AACA,gD;AACA,yS;;;;;;;;;;;;;;;;;;;ACRA,6B;AACA,yC;AACA,sC;;AAEA,gC;AACA,yD;AACA,C;;;;;;;;;;;;;;;;;;;ACNA,6B;AACA,yC;AACA,sC;;AAEA,gC;AACA,yD;AACA,C;;;;;;;;;;;;;;;;;;;ACNA,6B;AACA,yC;AACA,sC;;AAEA,gC;AACA,yD;AACA,C;;;;;;;;;;;;;;;;;;;ACNA,6B;AACA,yC;AACA,sC;;AAEA,gC;AACA,yD;AACA,C;;;;;;;;;;;;;;;;;;;ACNA,6B;AACA,yC;AACA,sC;;AAEA,gC;AACA,yD;AACA,C","sourcesContent":["TAPi18n.packages[\"telescope-singleday\"] = {\"translation_function_name\":\"__\",\"helper_name\":\"_\",\"namespace\":\"project\"};\n\n// define package's translation function (proxy to the i18next)\n__ = TAPi18n._getPackageI18nextProxy(\"project\");\n// define the package's templates registrar\nregisterI18nTemplate = TAPi18n._getRegisterHelpersProxy(\"telescope-singleday\");\nregisterTemplate = registerI18nTemplate; // XXX OBSOLETE, kept for backward compatibility will be removed in the future\n\n// Record the list of templates prior to package load\nvar _ = Package.underscore._;\nnon_package_templates = _.keys(Template);\n","// Controller for post digest\n\nPostsDigestController = RouteController.extend({\n  template: getTemplate('posts_digest'),\n  waitOn: function() {\n    // if day is set, use that. If not default to today\n    var currentDate = this.params.day ? new Date(this.params.year, this.params.month-1, this.params.day) : new Date(),\n        terms = {\n          view: 'digest',\n          after: moment(currentDate).startOf('day').toDate(),\n          before: moment(currentDate).endOf('day').toDate()\n        };\n    return [\n      coreSubscriptions.subscribe('postsList', terms),\n      coreSubscriptions.subscribe('postsListUsers', terms)\n    ];\n  },\n  data: function() {\n    var currentDate = this.params.day ? new Date(this.params.year, this.params.month-1, this.params.day) : Session.get('today'),\n        terms = {\n          view: 'digest',\n          after: moment(currentDate).startOf('day').toDate(),\n          before: moment(currentDate).endOf('day').toDate()\n        },\n        parameters = getPostsParameters(terms);\n    Session.set('currentDate', currentDate);\n\n    parameters.find.createdAt = { $lte: Session.get('listPopulatedAt') };\n    var posts = Posts.find(parameters.find, parameters.options);\n\n    // Incoming posts\n    parameters.find.createdAt = { $gt: Session.get('listPopulatedAt') };\n    var postsIncoming = Posts.find(parameters.find, parameters.options);\n\n    return {\n      incoming: postsIncoming,\n      posts: posts\n    };\n  },\n  fastRender: true\n});\n\nMeteor.startup(function () {\n\n  // Digest\n\n  Router.route('/digest/:year/:month/:day', {\n    name: 'posts_digest',\n    controller: PostsDigestController\n  });\n\n  Router.route('/digest', {\n    name: 'posts_digest_default',\n    controller: PostsDigestController\n  });\n\n});","viewNav.push({\n  route: 'posts_digest_default',\n  label: 'digest'\n});\n\nviewParameters.digest = function (terms) {\n  return {\n    find: {\n      postedAt: {\n        $gte: terms.after, \n        $lt: terms.before\n      }\n    },\n    options: {\n      sort: {sticky: -1, baseScore: -1, limit: 0}\n    }\n  };\n}\n\ngetDigestURL = function(moment){\n  return Router.routes['posts_digest'].path({\n    year: moment.year(),\n    month: moment.month() + 1,\n    day: moment.date()\n  });\n};","\nTemplate.__checkName(\"posts_digest\");\nTemplate[\"posts_digest\"] = new Template(\"Template.posts_digest\", (function() {\n  var view = this;\n  return [ HTML.DIV({\n    \"class\": \"grid\"\n  }, \"\\n    \", HTML.DIV({\n    \"class\": \"grid-block\"\n  }, \"\\n      \", Blaze.View(function() {\n    return Spacebars.mustache(view.lookup(\"_\"), \"the_top_5_posts_of_each_day\");\n  }), \" |\\n    \", Blaze.If(function() {\n    return Spacebars.call(view.lookup(\"showPreviousDate\"));\n  }, function() {\n    return [ \"\\n    \", HTML.A({\n      href: function() {\n        return Spacebars.mustache(view.lookup(\"previousDateURL\"));\n      },\n      \"class\": \"prev-link\"\n    }, Blaze.View(function() {\n      return Spacebars.mustache(view.lookup(\"_\"), \"previous_day\");\n    })), \" |\\n    \" ];\n  }), \"\\n    \", Blaze.View(function() {\n    return Spacebars.mustache(view.lookup(\"currentDate\"));\n  }), \" |\\n    \", Blaze.If(function() {\n    return Spacebars.call(view.lookup(\"showNextDate\"));\n  }, function() {\n    return [ \"\\n    \", HTML.A({\n      href: function() {\n        return Spacebars.mustache(view.lookup(\"nextDateURL\"));\n      },\n      \"class\": \"next-link\"\n    }, Blaze.View(function() {\n      return Spacebars.mustache(view.lookup(\"_\"), \"next_day\");\n    })), \"\\n    \" ];\n  }), \"\\n    \"), \"\\n  \"), \"\\n\\n  \", Blaze._TemplateWith(function() {\n    return {\n      template: Spacebars.call(view.lookup(\"postsListIncoming\")),\n      data: Spacebars.call(view.lookup(\"incoming\"))\n    };\n  }, function() {\n    return Spacebars.include(function() {\n      return Spacebars.call(Template.__dynamic);\n    });\n  }), \"\\n\\n  \", Blaze.If(function() {\n    return Spacebars.call(view.lookup(\"hasPosts\"));\n  }, function() {\n    return [ \"\\n    \", HTML.DIV({\n      \"class\": \"posts grid list\"\n    }, \"\\n      \", Blaze.Each(function() {\n      return Spacebars.call(view.lookup(\"posts\"));\n    }, function() {\n      return [ \"\\n        \", Blaze._TemplateWith(function() {\n        return {\n          template: Spacebars.call(view.lookup(\"post_item\"))\n        };\n      }, function() {\n        return Spacebars.include(function() {\n          return Spacebars.call(Template.__dynamic);\n        });\n      }), \"\\n      \" ];\n    }), \"\\n    \"), \"\\n  \" ];\n  }, function() {\n    return [ \"\\n    \", HTML.DIV({\n      \"class\": \"grid-small grid-block dialog\"\n    }, \"\\n      \", HTML.P(Blaze.View(function() {\n      return Spacebars.mustache(view.lookup(\"_\"), \"sorry_no_posts_for\");\n    }), \" \", Blaze.View(function() {\n      return Spacebars.mustache(view.lookup(\"currentDate\"));\n    }), \".\"), \"\\n    \"), \"\\n  \" ];\n  }) ];\n}));\n","Meteor.startup(function () {\n\n  Template[getTemplate('posts_digest')].created = function(){\n    $(document).unbind('keyup'); //remove any potential existing bindings to avoid duplicates\n    var currentDate=moment(Session.get('currentDate')).startOf('day');\n    var today=moment(new Date()).startOf('day');\n    $(document).bind('keyup', 'left', function(){\n      Router.go($('.prev-link').attr('href'));\n    });\n    $(document).bind('keyup', 'right', function(){\n      if(isAdmin(Meteor.user()) || today.diff(currentDate, 'days') > 0)\n        Router.go($('.next-link').attr('href'));      \n    });  \n  };\n\n  Template[getTemplate('posts_digest')].helpers({\n    post_item: function () {\n      return getTemplate('post_item');\n    },\n    postsListIncoming: function () {\n      return getTemplate('postsListIncoming');\n    },\n    hasPosts: function(){\n      if(this.posts) // XXX\n        return !!this.posts.count();  \n    },\n    currentDate: function(){\n      var currentDate=moment(Session.get('currentDate'));\n      var today=moment(new Date());\n      var diff=today.diff(currentDate, 'days');\n      if(diff === 0)\n        return i18n.t(\"today\");\n      if(diff === 1)\n        return i18n.t(\"yesterday\");\n      return currentDate.format(\"dddd, MMMM Do YYYY\");\n    },\n    previousDateURL: function(){\n      var currentDate=moment(Session.get('currentDate'));\n      var newDate=currentDate.subtract(1, 'days');\n      return getDigestURL(newDate);\n    },\n    showPreviousDate: function(){\n      // TODO\n      return true;\n    },\n    nextDateURL: function(){\n      var currentDate=moment(Session.get('currentDate'));\n      var newDate=currentDate.add('days', 1);\n      return getDigestURL(newDate);\n    },\n    showNextDate: function(){\n      var currentDate=moment(Session.get('currentDate')).startOf('day');\n      var today=moment(new Date()).startOf('day');\n      return isAdmin(Meteor.user()) || (today.diff(currentDate, 'days') > 0)\n    }\n  });\n\n  Template[getTemplate('posts_digest')].rendered = function(){\n    var distanceFromTop = 0;\n    $('.post').each(function(){\n      distanceFromTop += $(this).height();\n    });\n    distanceFromTop+=55;\n    Session.set('distanceFromTop', distanceFromTop);\n    $('body').css('min-height',distanceFromTop+160);\n    $('.more-button').css('top', distanceFromTop+\"px\");  \n  }\n\n  Template[getTemplate('posts_digest')].created = function() {\n    Session.set('listPopulatedAt', new Date());\n  };\n\n});","var _ = Package.underscore._,\n    package_name = \"telescope-singleday\",\n    namespace = \"telescope-singleday\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\nvar package_templates = _.difference(_.keys(Template), non_package_templates);\n\nfor (var i = 0; i < package_templates.length; i++) {\n  var package_template = package_templates[i];\n\n  registerI18nTemplate(package_template);\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope-singleday\",\n    namespace = \"telescope-singleday\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n// integrate the fallback language translations \nTAPi18n.addResourceBundle(\"en\", namespace, {\"the_top_5_posts_of_each_day\":\"The top 5 posts of each day.\",\"previous_day\":\"Previous Day\",\"next_day\":\"Next Day\",\"sorry_no_posts_for_today\":\"Sorry, no posts for today\",\"sorry_no_posts_for\":\"Sorry, no posts for\",\"today\":\"Today\",\"yesterday\":\"Yesterday\"});\n","var _ = Package.underscore._,\n    package_name = \"telescope-singleday\",\n    namespace = \"telescope-singleday\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope-singleday\",\n    namespace = \"telescope-singleday\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope-singleday\",\n    namespace = \"telescope-singleday\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope-singleday\",\n    namespace = \"telescope-singleday\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n","var _ = Package.underscore._,\n    package_name = \"telescope-singleday\",\n    namespace = \"telescope-singleday\";\n\nif (package_name != \"project\") {\n    namespace = TAPi18n.packages[package_name].namespace;\n}\n"]}